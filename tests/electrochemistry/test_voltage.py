#!/usr/bin/env python
# -*- coding: utf-8 -*-

# This file is part of exma (https://github.com/fernandezfran/exma/).
# Copyright (c) 2021, Francisco Fernandez
# License: MIT
#   Full Text: https://github.com/fernandezfran/exma/blob/master/LICENSE

# ======================================================================
# IMPORTS
# ======================================================================

import exma.electrochemistry

import numpy as np

import pandas as pd

# ======================================================================
# TESTS
# ======================================================================


def test_voltage():
    """Test the voltage approximation."""
    reffe_spline = np.array(
        [
            0.8766071,
            0.8881785,
            0.8997439,
            0.9113034,
            0.9228569,
            0.9344045,
            0.9459461,
            0.9574818,
            0.9690115,
            0.98053527,
            0.9920531,
            1.003565,
            1.0150709,
            1.0265709,
            1.0380648,
            1.0495529,
            1.061035,
            1.0725112,
            1.0839815,
            1.0954458,
            1.106904,
            1.1183565,
            1.1298028,
            1.1412433,
            1.1526779,
            1.1641064,
            1.175529,
            1.1869457,
            1.1983564,
            1.2097611,
            1.22116,
            1.2325529,
            1.2439398,
            1.2553208,
            1.2666959,
            1.2780648,
            1.289428,
            1.3007852,
            1.3121364,
            1.3234817,
            1.334821,
            1.3461543,
            1.3574818,
            1.3688033,
            1.3801187,
            1.3914284,
            1.402732,
            1.4140296,
            1.4253213,
            1.4366071,
        ],
    )
    refvoltage = np.array(
        [
            -0.5671429,
            -0.5668513,
            -0.5665598,
            -0.56626827,
            -0.5659767,
            -0.56568515,
            -0.5653936,
            -0.56510204,
            -0.5648105,
            -0.5645189,
            -0.5642274,
            -0.5639359,
            -0.5636443,
            -0.56335276,
            -0.56306124,
            -0.56276965,
            -0.5624781,
            -0.5621866,
            -0.561895,
            -0.5616035,
            -0.56131196,
            -0.5610204,
            -0.56072885,
            -0.5604373,
            -0.56014574,
            -0.5598542,
            -0.5595627,
            -0.5592711,
            -0.5589796,
            -0.55868804,
            -0.55839646,
            -0.55810493,
            -0.5578134,
            -0.5575218,
            -0.5572303,
            -0.55693877,
            -0.5566472,
            -0.55635566,
            -0.5560641,
            -0.55577254,
            -0.555481,
            -0.5551895,
            -0.5548979,
            -0.5546064,
            -0.55431485,
            -0.55402327,
            -0.55373174,
            -0.5534402,
            -0.5531486,
            -0.5528571,
        ],
    )

    x = np.linspace(0, 1, num=5)
    fe = np.array([0.875000, 1.021875, 1.156250, 1.296875, 1.437500])
    df = pd.DataFrame({"x": x, "fe": fe})

    result = exma.electrochemistry.voltage(df, k=2)

    np.testing.assert_almost_equal(result.x, np.linspace(0, 1))
    np.testing.assert_almost_equal(result.fe_spline, reffe_spline, 6)
    np.testing.assert_almost_equal(result.voltage, refvoltage)
